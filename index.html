<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Steganography Decoder</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
</head>
<body>
    <h1>Upload Image to Reveal Secret Message</h1>
    <input type="file" id="imageInput" accept="image/png, image/jpeg">
    <p id="output">Decoded message will appear here...</p>

    <script type="text/javascript">
        async function main() {
            let pyodide = await loadPyodide();
            await pyodide.loadPackage("micropip");
            await pyodide.runPythonAsync(`
                import micropip
                await micropip.install('Pillow')
                from PIL import Image
                import io
                import base64

                def decode_image(base64_string):
                    # Convert base64 to image
                    img_data = base64.b64decode(base64_string)
                    img = Image.open(io.BytesIO(img_data))
                    img = img.convert("RGB")
                    pixels = list(img.getdata())

                    # Extract binary message (LSB method)
                    binary_message = ""
                    for pixel in pixels:
                        for value in pixel[:3]:  # RGB channels
                            binary_message += str(value & 1)
                            if len(binary_message) >= 16:  # Assuming max 2 chars (16 bits)
                                break
                        if len(binary_message) >= 16:
                            break

                    # Convert binary to text
                    message = ""
                    for i in range(0, len(binary_message), 8):
                        byte = binary_message[i:i+8]
                        if len(byte) == 8:
                            char = chr(int(byte, 2))
                            message += char
                        else:
                            break

                    return message

                # Export function to JavaScript
                __pyodide__.globals.set("decode_image", decode_image)
            `);

            const input = document.getElementById('imageInput');
            const output = document.getElementById('output');

            input.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const base64String = e.target.result.split(',')[1]; // Get base64 data
                        const decodedMessage = await pyodide.runPythonAsync(`decode_image("${base64String}")`);
                        output.textContent = `Decoded message: ${decodedMessage}`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        main();
    </script>
</body>
</html>
